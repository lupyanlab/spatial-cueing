---
title: "Spatial cueing at short and long intervals"
author: "Pierce Edmiston"
date: "April 29, 2015"
output: html_document
---

```{r, get-spatial-cueing, message = FALSE}
source("R/loaders.R")
cueing <- get_spatial_cueing(interval = c(0.750, 0.100), flicker = "on")
cueing %>% group_by(interval, flicker, subj_id) %>%
  summarize(num_trials = n(),
            mean_acc = mean(is_correct))
```

# Cueing effect in accuracies
```{r, fit-glmer-mod, message = FALSE}
library(lme4)
library(broom)
source("R/recoders.R")

cueing <- set_treatment_contrasts(cueing)
cueing$interval_c <- recode_interval_as_centered_num(cueing)
cueing$interval_lab <- label_interval(cueing)

accuracy_mod <- glmer(data = cueing, family = "binomial",
  formula = is_correct ~ (frame_v_nocue + sound_v_nocue) * interval_c + 
              (frame_v_nocue + sound_v_nocue || subj_id))
  ## the double pipe fits random intercepts and slopes without
  ## random effect correlations
tidy(accuracy_mod, effects = "fixed")
```

```{r, plot-accuracies, message = FALSE, fig.width = 10}
source("R/plots.R")
source("R/models.R")

# summarize the raw data by subject
cueing_by_subj <- cueing %>% group_by(interval_lab, subj_id, cue_type) %>%
  summarize(accuracy = mean(is_correct))

# get the model estimates
x_preds <- expand.grid(cue_type = c("nocue", "frame", "sound"), interval = c(0.75, 0.10)) %>%
  set_treatment_contrasts() %>%
  mutate(
    cue_type_int = recode_cue_type_as_int(.),
    interval_c = recode_interval_as_centered_num(.),
    interval_lab = label_interval(.)
  )
acc_mod_preds <- get_glmer_predictions(accuracy_mod, x_preds)

# base plot subj accuracies
acc_by_subj_plot <- plot_acc_by_subj(cueing_by_subj) +
  facet_wrap("interval_lab", nrow = 1)

# add on model predictions
acc_mod_plot <- acc_by_subj_plot +
  geom_ribbon(aes(ymin = accuracy - se, ymax = accuracy + se),
    data = acc_mod_preds, fill = "gray", alpha = 0.8) +
  geom_line(aes(group = 1), data = acc_mod_preds)
acc_mod_plot
```

```{r, summarize-rts-for-plot, fig.width = 10}
source("R/recoders.R")
cueing$trial_type <- determine_trial_type(cueing)
hit_trials <- filter(cueing, trial_type == 'hit')

rts_by_subj <- hit_trials %>% group_by(interval, subj_id, cue_type) %>%
  summarize(rt = mean(rt))

rts_by_subj$cue_type_int <- recode_cue_type_as_int(rts_by_subj)
rts_by_subj$cue_type_jit <- jitter_cue_type_int_by_subj(rts_by_subj)
rts_by_subj$interval_lab <- label_interval(rts_by_subj)

plot_rts_by_subj <- ggplot(rts_by_subj,
    aes(x = cue_type_int, y = rt)) +
  geom_point(aes(x = cue_type_jit, color = subj_id), shape = by_subj_point_shape) +
  geom_line(aes(x = cue_type_jit, color = subj_id), shape = by_subj_line_size) +
  facet_wrap("interval_lab", nrow = 1) +
  scale_cue_type_int +
  scale_y_continuous("Response Time (ms)") +
  theme(legend.position = "none")
plot_rts_by_subj
```

```{r, fit-lmer-model}
rt_mod <- lmer(rt ~ (frame_v_nocue + sound_v_nocue) * interval_c +
                     (frame_v_nocue + sound_v_nocue || subj_id),
                   data = hit_trials)
summary(rt_mod)
```